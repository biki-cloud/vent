# Whisper 要件定義書および設計書

## 1. プロジェクト概要

- **アプリ名**: Whisper
- **コンセプト**: 匿名で、1 日 1 回だけ、自分の心の声を言葉にして「そっと落とす」場を提供。
- **目的**: ユーザーが心の中を吐き出してストレスを解消し、安心して眠れる環境を作る。
- **ターゲット層**: ストレスを抱える全ての人、特に社会的プレッシャーの高い環境にいるユーザー。

---

## 2. 要件定義

### 2.1 機能要件

#### コア機能

1. **匿名投稿機能**

   - 1 日 1 回のみ投稿可能。
   - 投稿内容は 24 時間後に自動削除される。

2. **投稿閲覧機能**

   - 他のユーザーの投稿をランダムで閲覧可能。
   - 投稿にはユーザー名や個人情報は表示されない。

3. **感情タグ選択機能**

   - 投稿時に感情タグを選択可能（例: 安心、悲しい、嬉しい）。

4. **共感ボタン**
   - 投稿に「共感」ボタンを付与。
   - 他のユーザーが押した共感の数を投稿に表示。

#### 付加機能

- シンプルな UI/UX で直感的な操作性。
- ダークモード対応。
- 多言語対応（初期は日本語と英語）。

### 2.2 非機能要件

1. **パフォーマンス**

   - 投稿の表示速度は 1 秒以内。
   - 1 日最大 1 万投稿を想定。

2. **セキュリティ**

   - 匿名性の完全な確保。
   - 投稿データの暗号化。

3. **スケーラビリティ**

   - 利用者増加に対応可能なアーキテクチャ。

4. **運用要件**
   - 投稿データのバックアップ（24 時間のみ保持）。
   - ログ管理（アクセスログ、エラーログ）。

---

## 3. システム設計

### 3.1 技術スタック

- **バックエンド**: Django (Python)
- **フロントエンド**: React (TypeScript) + Tailwind CSS
- **データベース**: PostgreSQL（AWS RDS）
- **ホスティング**: AWS（EC2、S3、CloudFront）
- **インフラ管理**: Terraform
- **デプロイ**: GitHub Actions

### 3.2 システム構成図

1. **フロントエンド**: React + Tailwind CSS

   - ユーザーインターフェースの提供。
   - API を介してバックエンドと通信。

2. **バックエンド**: Django REST Framework

   - 投稿の処理、感情タグ管理、共感ボタンのロジック。
   - 投稿の 24 時間自動削除のスケジュール管理。

3. **データベース**: PostgreSQL

   - 投稿データ（内容、感情タグ、共感数）を管理。

4. **ホスティング**: AWS

   - フロントエンド: S3 + CloudFront で静的ホスティング。
   - バックエンド: EC2 インスタンスで運用。

5. **デプロイと CI/CD**
   - GitHub Actions を用いた自動テスト・デプロイフロー。

---

## 4. ユーザーフロー

### 4.1 投稿フロー

1. ユーザーがアプリを開く。
2. テキストボックスに感情や思いを書き込む。
3. 感情タグを選択。
4. 「投稿する」ボタンを押下。
5. 投稿が 24 時間後に自動削除される。

### 4.2 閲覧フロー

1. ユーザーがアプリを開く。
2. ランダムに表示される投稿をスクロールして閲覧。
3. 気に入った投稿に「共感」ボタンを押す。

---

## 5. 開発スケジュール

### フェーズ 1: 要件定義・設計

- 要件定義書および設計書の作成。
- デザインモックアップの作成。

### フェーズ 2: バックエンド開発

- Django REST Framework による API 開発。
- 投稿管理ロジックの実装。

### フェーズ 3: フロントエンド開発

- React + Tailwind CSS で UI を構築。
- API との統合。

### フェーズ 4: テストと調整

- ユニットテスト、統合テスト。
- ユーザビリティテスト。

### フェーズ 5: デプロイとリリース

- インフラ構築とデプロイ。
- 初期ユーザーへの公開。

---

## 6. 今後の展開

- 投稿に対する簡易な「反応」機能の追加。
- 短文詩や引用の提案機能。
- スマートフォンアプリ版の展開。

---

## 7. 開発環境セットアップ

### 必要な環境

- Python 3.12 以上
- Node.js 18 以上
- Redis

### バックエンド環境構築

```bash
# リポジトリのクローン
git clone [repository-url]
cd whisper

# バックエンド環境のセットアップ
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# データベースのセットアップ
python manage.py migrate

# 開発サーバーの起動
python manage.py runserver 8080
```

### フロントエンド環境構築

```bash
cd frontend
npm install
npm run dev
```

## 8. API 仕様

### エンドポイント一覧

#### 投稿関連

- `POST /api/posts/`

  - 新規投稿の作成
  - 1 日 1 回のみ投稿可能
  - 24 時間後に自動非表示

- `GET /api/posts/`

  - 有効な投稿の一覧を取得
  - ページネーション対応（10 件ずつ）

- `GET /api/posts/random/`

  - ランダムな投稿を取得（最大 10 件）

- `POST /api/posts/{id}/empathy/`
  - 投稿への共感を示す

#### 感情タグ関連

- `GET /api/emotion-tags/`
  - 利用可能な感情タグの一覧を取得

### リクエスト例

#### 投稿の作成

```bash
curl -X POST http://localhost:8080/api/posts/ \
  -H "Content-Type: application/json" \
  -d '{"content": "今日は良い一日だった", "emotion_tag_id": 1}'
```

#### ランダムな投稿の取得

```bash
curl http://localhost:8080/api/posts/random/
```

## 9. 開発ガイドライン

### コーディング規約

- PEP 8 に準拠した Python コード
- ESLint に準拠した TypeScript コード

### テスト

```bash
# バックエンドのテスト実行
cd backend
python manage.py test

# フロントエンドのテスト実行
cd frontend
npm test
```

### リンター実行

```bash
# バックエンド
flake8 backend

# フロントエンド
cd frontend
npm run lint
```

---

以上が「Whisper」の要件定義および設計書です。追加のご要望や修正があればお知らせください！
